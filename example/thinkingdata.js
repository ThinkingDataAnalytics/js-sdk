(function(){"use strict";function _typeof(obj){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,_toPropertyKey(descriptor.key),descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:false});return Constructor}function _toPrimitive(input,hint){if(typeof input!=="object"||input===null)return input;var prim=input[Symbol.toPrimitive];if(prim!==undefined){var res=prim.call(input,hint||"default");if(typeof res!=="object")return res;throw new TypeError("@@toPrimitive must return a primitive value.")}return(hint==="string"?String:Number)(input)}function _toPropertyKey(arg){var key=_toPrimitive(arg,"string");return typeof key==="symbol"?key:String(key)}if((typeof JSON==="undefined"?"undefined":_typeof(JSON))!=="object"){JSON={}}(function(){var rx_one=/^[\],:{}\s]*$/;var rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g;var rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g;var rx_four=/(?:^|:|,)(?:\s*\[)+/g;var rx_escapable=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;var rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;function f(n){return n<10?"0"+n:n}function this_value(){return this.valueOf()}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};Boolean.prototype.toJSON=this_value;Number.prototype.toJSON=this_value;String.prototype.toJSON=this_value}var gap;var indent;var meta;var rep;function quote(string){rx_escapable.lastIndex=0;return rx_escapable.test(string)?'"'+string.replace(rx_escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i;var k;var v;var length;var mind=gap;var partial;var value=holder[key];if(value&&_typeof(value)==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(_typeof(value)){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&_typeof(rep)==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else if(typeof space==="string"){indent=space}rep=replacer;if(replacer&&typeof replacer!=="function"&&(_typeof(replacer)!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k;var v;var value=holder[key];if(value&&_typeof(value)==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);rx_dangerous.lastIndex=0;if(rx_dangerous.test(text)){text=text.replace(rx_dangerous,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}})();var Config={LIB_VERSION:"1.6.2"};var MAX_REFERRER_STRING_LENGTH=200;var ArrayProto=Array.prototype;var ObjProto=Object.prototype;var slice=ArrayProto.slice;var toString=ObjProto.toString;var hasOwnProperty=ObjProto.hasOwnProperty;var nativeForEach=ArrayProto.forEach;var breaker={};var utmTypes=["utm_source","utm_medium","utm_campaign","utm_content","utm_term"];var _={};_.each=function(obj,iterator,context){if(obj===null){return}if(nativeForEach&&obj.forEach===nativeForEach){obj.forEach(iterator,context)}else if(obj.length===+obj.length){for(var i=0,l=obj.length;i<l;i++){if(i in obj&&iterator.call(context,obj[i],i,obj)===breaker){return}}}else{for(var key in obj){if(hasOwnProperty.call(obj,key)){if(iterator.call(context,obj[key],key,obj)===breaker){return}}}}};_.extend=function(obj){_.each(slice.call(arguments,1),function(source){for(var prop in source){if(source[prop]!==void 0){obj[prop]=source[prop]}}});return obj};_.formatDate=function(d){function pad(n){return n<10?"0"+n:n}function padMilliseconds(n){if(n<10){return"00"+n}else if(n<100){return"0"+n}else{return n}}return d.getFullYear()+"-"+pad(d.getMonth()+1)+"-"+pad(d.getDate())+" "+pad(d.getHours())+":"+pad(d.getMinutes())+":"+pad(d.getSeconds())+"."+padMilliseconds(d.getMilliseconds())};_.formatTimeZone=function(d,i){if(typeof i!=="number")return d;var len=d.getTime();var offset=d.getTimezoneOffset()*6e4;var utcTime=len+offset;return new Date(utcTime+36e5*i)};_.formatJsonString=function(obj){try{return JSON.stringify(obj,null,8)}catch(e){return JSON.stringify(obj)}};_.searchObjDate=function(o,i){if(_.check.isObject(o)||_.check.isArray(o)){_.each(o,function(a,b){if(_.check.isObject(a)||_.check.isArray(a)){_.searchObjDate(o[b],i)}else{if(_.check.isDate(a)){o[b]=_.formatDate(_.formatTimeZone(a,i))}}})}};_.check={isUndefined:function isUndefined(obj){return obj===void 0},isObject:function isObject(obj){return toString.call(obj)==="[object Object]"&&obj!==null},isEmptyObject:function isEmptyObject(obj){if(_.check.isObject(obj)){for(var key in obj){if(hasOwnProperty.call(obj,key)){return false}}return true}return false},isArray:function isArray(obj){return toString.call(obj)==="[object Array]"},isString:function isString(obj){return toString.call(obj)==="[object String]"},isDate:function isDate(obj){return toString.call(obj)==="[object Date]"},isNumber:function isNumber(obj){return toString.call(obj)==="[object Number]"},isBoolean:function isBoolean(obj){return toString.call(obj)==="[object Boolean]"},isJSONString:function isJSONString(str){try{JSON.parse(str)}catch(e){return false}return true}};_.UUID=function(){var T=function T(){var d=1*new Date;var i=0;while(d===1*new Date){i++}return d.toString(16)+i.toString(16)};var R=function R(){return Math.random().toString(16).replace(".","")};var UA=function UA(){var ua=navigator.userAgent;var i;var ch;var buffer=[];var ret=0;function xor(result,byteArray){var j;var tmp=0;for(j=0;j<byteArray.length;j++){tmp|=buffer[j]<<j*8}return result^tmp}for(i=0;i<ua.length;i++){ch=ua.charCodeAt(i);buffer.unshift(ch&255);if(buffer.length>=4){ret=xor(ret,buffer);buffer=[]}}if(buffer.length>0){ret=xor(ret,buffer)}return ret.toString(16)};return function(){var se=String(screen.height*screen.width);if(se&&/\d{5,}/.test(se)){se=se.toString(16)}else{se=String(Math.random()*31242).replace(".","").slice(0,8)}var val=T()+"-"+R()+"-"+UA()+"-"+se+"-"+T();if(val){return val}else{return(String(Math.random())+String(Math.random())+String(Math.random())).slice(2,15)}}}();_.UUIDv4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:r&3|8;return v.toString(16)})};_.getReferrer=function(targetReferrer){var referrer=targetReferrer||document.referrer;if(typeof referrer!=="string"){return"referrer exception"+String(referrer)}if(referrer.indexOf("https://www.baidu.com/")===0){referrer=referrer.split("?")[0]}referrer=referrer.slice(0,MAX_REFERRER_STRING_LENGTH);return typeof referrer==="string"?referrer:""};_.url=function(){function _t(){return new RegExp(/(.*?)\.?([^\.]*?)\.(com|net|org|biz|ws|in|me|co\.uk|co|org\.uk|ltd\.uk|plc\.uk|me\.uk|edu|mil|br\.com|cn\.com|eu\.com|hu\.com|no\.com|qc\.com|sa\.com|se\.com|se\.net|us\.com|uy\.com|ac|co\.ac|gv\.ac|or\.ac|ac\.ac|af|am|as|at|ac\.at|co\.at|gv\.at|or\.at|asn\.au|com\.au|edu\.au|org\.au|net\.au|id\.au|be|ac\.be|adm\.br|adv\.br|am\.br|arq\.br|art\.br|bio\.br|cng\.br|cnt\.br|com\.br|ecn\.br|eng\.br|esp\.br|etc\.br|eti\.br|fm\.br|fot\.br|fst\.br|g12\.br|gov\.br|ind\.br|inf\.br|jor\.br|lel\.br|med\.br|mil\.br|net\.br|nom\.br|ntr\.br|odo\.br|org\.br|ppg\.br|pro\.br|psc\.br|psi\.br|rec\.br|slg\.br|tmp\.br|tur\.br|tv\.br|vet\.br|zlg\.br|br|ab\.ca|bc\.ca|mb\.ca|nb\.ca|nf\.ca|ns\.ca|nt\.ca|on\.ca|pe\.ca|qc\.ca|sk\.ca|yk\.ca|ca|cc|ac\.cn|net\.cn|com\.cn|edu\.cn|gov\.cn|org\.cn|bj\.cn|sh\.cn|tj\.cn|cq\.cn|he\.cn|nm\.cn|ln\.cn|jl\.cn|hl\.cn|js\.cn|zj\.cn|ah\.cn|gd\.cn|gx\.cn|hi\.cn|sc\.cn|gz\.cn|yn\.cn|xz\.cn|sn\.cn|gs\.cn|qh\.cn|nx\.cn|xj\.cn|tw\.cn|hk\.cn|mo\.cn|cn|cx|cz|de|dk|fo|com\.ec|tm\.fr|com\.fr|asso\.fr|presse\.fr|fr|gf|gs|co\.il|net\.il|ac\.il|k12\.il|gov\.il|muni\.il|ac\.in|co\.in|org\.in|ernet\.in|gov\.in|net\.in|res\.in|is|it|ac\.jp|co\.jp|go\.jp|or\.jp|ne\.jp|ac\.kr|co\.kr|go\.kr|ne\.kr|nm\.kr|or\.kr|li|lt|lu|asso\.mc|tm\.mc|com\.mm|org\.mm|net\.mm|edu\.mm|gov\.mm|ms|nl|no|nu|pl|ro|org\.ro|store\.ro|tm\.ro|firm\.ro|www\.ro|arts\.ro|rec\.ro|info\.ro|nom\.ro|nt\.ro|se|si|com\.sg|org\.sg|net\.sg|gov\.sg|sk|st|tf|ac\.th|co\.th|go\.th|mi\.th|net\.th|or\.th|tm|to|com\.tr|edu\.tr|gov\.tr|k12\.tr|net\.tr|org\.tr|com\.tw|org\.tw|net\.tw|ac\.uk|uk\.com|uk\.net|gb\.com|gb\.net|vg|sh|kz|ch|info|ua|gov|name|pro|ie|hk|com\.hk|org\.hk|net\.hk|edu\.hk|us|tk|cd|by|ad|lv|eu\.lv|bz|es|jp|cl|ag|mobi|eu|co\.nz|org\.nz|net\.nz|maori\.nz|iwi\.nz|io|la|md|sc|sg|vc|tw|travel|my|se|tv|pt|com\.pt|edu\.pt|asia|fi|com\.ve|net\.ve|fi|org\.ve|web\.ve|info\.ve|co\.ve|tel|im|gr|ru|net\.ru|org\.ru|hr|com\.hr|ly|xyz)$/)}function _d(s){return _.decodeURIComponent(s.replace(/\+/g," "))}function _i(arg,str){var sptr=arg.charAt(0);var split=str.split(sptr);if(sptr===arg){return split}arg=parseInt(arg.substring(1),10);return split[arg<0?split.length+arg:arg-1]}function _f(arg,str){var sptr=arg.charAt(0);var split=str.split("&");var field=[];var params={};var tmp=[];var arg2=arg.substring(1);for(var i=0,ii=split.length;i<ii;i++){field=split[i].match(/(.*?)=(.*)/);if(!field){field=[split[i],split[i],""]}if(field[1].replace(/\s/g,"")!==""){field[2]=_d(field[2]||"");if(arg2===field[1]){return field[2]}tmp=field[1].match(/(.*)\[([0-9]+)\]/);if(tmp){params[tmp[1]]=params[tmp[1]]||[];params[tmp[1]][tmp[2]]=field[2]}else{params[field[1]]=field[2]}}}if(sptr===arg){return params}return params[arg2]}return function(arg,url){var _l={},tmp;if(arg==="tld?"){return _t()}url=url||window.location.toString();if(!arg){return url}arg=arg.toString();if(tmp=url.match(/^mailto:([^\/].+)/)){_l.protocol="mailto";_l.email=tmp[1]}else{if(tmp=url.match(/(.*?)\/#\!(.*)/)){url=tmp[1]+tmp[2]}if(tmp=url.match(/(.*?)#(.*)/)){_l.hash=tmp[2];url=tmp[1]}if(_l.hash&&arg.match(/^#/)){return _f(arg,_l.hash)}if(tmp=url.match(/(.*?)\?(.*)/)){_l.query=tmp[2];url=tmp[1]}if(_l.query&&arg.match(/^\?/)){return _f(arg,_l.query)}if(tmp=url.match(/(.*?)\:?\/\/(.*)/)){_l.protocol=tmp[1].toLowerCase();url=tmp[2]}if(tmp=url.match(/(.*?)(\/.*)/)){_l.path=tmp[2];url=tmp[1]}_l.path=(_l.path||"").replace(/^([^\/])/,"/$1").replace(/\/$/,"");if(arg.match(/^[\-0-9]+$/)){arg=arg.replace(/^([^\/])/,"/$1")}if(arg.match(/^\//)){return _i(arg,_l.path.substring(1))}tmp=_i("/-1",_l.path.substring(1));if(tmp&&(tmp=tmp.match(/(.*?)\.(.*)/))){_l.file=tmp[0];_l.filename=tmp[1];_l.fileext=tmp[2]}if(tmp=url.match(/(.*)\:([0-9]+)$/)){_l.port=tmp[2];url=tmp[1]}if(tmp=url.match(/(.*?)@(.*)/)){_l.auth=tmp[1];url=tmp[2]}if(_l.auth){tmp=_l.auth.match(/(.*)\:(.*)/);_l.user=tmp?tmp[1]:_l.auth;_l.pass=tmp?tmp[2]:undefined}_l.hostname=url.toLowerCase();if(arg.charAt(0)==="."){return _i(arg,_l.hostname)}if(_t()){tmp=_l.hostname.match(_t());if(tmp){_l.tld=tmp[3];_l.domain=tmp[2]?tmp[2]+"."+tmp[3]:undefined;_l.sub=tmp[1]||undefined}}var portInfo=_l.port?":"+_l.port:"";_l.protocol=_l.protocol||window.location.protocol.replace(":","");_l.port=_l.port||(_l.protocol==="https"?"443":"80");_l.protocol=_l.protocol||(_l.port==="443"?"https":"http");_l.basic=_l.protocol+"://"+_l.hostname+portInfo}if(arg in _l){return _l[arg]}if(arg==="{}"){return _l}return""}}();_.hashCode=function(str){if(typeof str!=="string"){return 0}var hash=0;var _char=null;if(str.length===0){return hash}for(var i=0;i<str.length;i++){_char=str.charCodeAt(i);hash=(hash<<5)-hash+_char;hash=hash&hash}return hash};_.decodeURIComponent=function(val){var result="";try{result=decodeURIComponent(val)}catch(e){result=val}return result};_.encodeURIComponent=function(val){var result="";try{result=encodeURIComponent(val)}catch(e){result=val}return result};_.utf8Encode=function(string){string=(string+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n");var utftext="";var start,end;var stringl=0;var n;start=end=0;stringl=string.length;for(n=0;n<stringl;n++){var c1=string.charCodeAt(n);var enc=null;if(c1<128){end++}else if(c1>127&&c1<2048){enc=String.fromCharCode(c1>>6|192,c1&63|128)}else{enc=String.fromCharCode(c1>>12|224,c1>>6&63|128,c1&63|128)}if(enc!==null){if(end>start){utftext+=string.substring(start,end)}utftext+=enc;start=end=n+1}}if(end>start){utftext+=string.substring(start,string.length)}return utftext};_.base64Encode=function(data){var b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var o1,o2,o3,h1,h2,h3,h4,bits;var i=0,ac=0,enc="",tmpArr=[];if(!data){return data}data=_.utf8Encode(data);do{o1=data.charCodeAt(i++);o2=data.charCodeAt(i++);o3=data.charCodeAt(i++);bits=o1<<16|o2<<8|o3;h1=bits>>18&63;h2=bits>>12&63;h3=bits>>6&63;h4=bits&63;tmpArr[ac++]=b64.charAt(h1)+b64.charAt(h2)+b64.charAt(h3)+b64.charAt(h4)}while(i<data.length);enc=tmpArr.join("");switch(data.length%3){case 1:enc=enc.slice(0,-2)+"==";break;case 2:enc=enc.slice(0,-1)+"=";break}return enc};_.cookie={get:function get(name){var nameEQ=name+"=";var ca=document.cookie.split(";");for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)===" "){c=c.substring(1,c.length)}if(c.indexOf(nameEQ)===0){return _.decodeURIComponent(c.substring(nameEQ.length,c.length))}}return null},set:function set(name,value,days,crossSubDomain,isSecure){var cDomain="",expires="",secure="";days=days===null?73e3:days;if(crossSubDomain){var domain=_.url("domain",location.href);cDomain=domain?"; domain=."+domain:""}if(days){var date=new Date;if(String(days).slice(-1)==="s"){date.setTime(date.getTime()+Number(String(days).slice(0,-1))*1e3)}else{date.setTime(date.getTime()+days*24*60*60*1e3)}expires="; expires="+date.toGMTString()}if(isSecure){secure="; secure"}var newCookieValue=name+"="+encodeURIComponent(value)+expires+"; path=/"+cDomain+secure;document.cookie=newCookieValue;return newCookieValue},remove:function remove(name,crossSubDomain){_.cookie.set(name,"",-1,crossSubDomain)}};_.localStorage={get:function get(name){try{return window.localStorage.getItem(name)}catch(err){_.localStorage.error(err)}},parse:function parse(name){var storedValue;try{storedValue=JSON.parse(_.localStorage.get(name))||null}catch(err){_.localStorage.error(err)}return storedValue},set:function set(name,value){try{window.localStorage.setItem(name,value)}catch(err){_.localStorage.error(err)}},remove:function remove(name){try{window.localStorage.removeItem(name)}catch(err){_.localStorage.error(err)}},error:function error(msg){console.error("localStorage error: "+msg)},isSupported:function isSupported(){var supported=true;try{var key="__thinkingdatasupport__";var val="testIsSupportStorage";_.localStorage.set(key,val);if(_.localStorage.get(key)!==val){supported=false}_.localStorage.remove(key)}catch(err){supported=false}return supported}};_.stripEmptyProperties=function(p){var ret={};_.each(p,function(v,k){if(_.check.isString(v)&&v.length>0){ret[k]=v}});return ret};_.info={os:function os(){var a=navigator.userAgent;if(/Windows/i.test(a)){if(/Phone/.test(a)||/WPDesktop/.test(a)){return"Windows Phone"}return"Windows"}else if(/(iPhone|iPad|iPod)/.test(a)){return"iOS"}else if(/Android/.test(a)){return"Android"}else if(/(BlackBerry|PlayBook|BB10)/i.test(a)){return"BlackBerry"}else if(/Mac/i.test(a)){return"Mac OS X"}else if(/Linux/.test(a)){return"Linux"}else if(/CrOS/.test(a)){return"Chrome OS"}else{return""}},browser:function browser(){var browser={type:"",version:""};try{var ua=navigator.userAgent.toLowerCase();var versionMatch=[];if(ua.match(/baidubrowser/)!==null){browser["type"]="baidu";versionMatch.push(/baidubrowser\/([\d.]+)/)}else if(ua.match(/bidubrowser/)!==null){browser["type"]="baidu";versionMatch.push(/bidubrowser\/([\d.]+)/)}else if(ua.match(/edga/)!==null){browser["type"]="edge";versionMatch.push(/edga\/([\d.]+)/)}else if(ua.match(/edgios/)!==null){browser["type"]="edge";versionMatch.push(/edgios\/([\d.]+)/)}else if(ua.match(/liebaofast/)!==null){browser["type"]="liebao";versionMatch.push(/liebaofast\/([\d.]+)/)}else if(ua.match(/sogoumobilebrowser/)!==null){browser["type"]="sogou";versionMatch.push(/sogoumobilebrowser\/([\d.]+)/)}else if(ua.match(/lbbrowser/)!==null){browser["type"]="liebao";versionMatch.push(/lbbrowser\/([\d.]+)/)}else if(ua.match(/crios/)!==null){browser["type"]="chrome";versionMatch.push(/crios\/([\d.]+)/)}else if(ua.match(/qihoobrowser/)!==null){browser["type"]="360";versionMatch.push(/qihoobrowser\/([\d.]+)/)}else if(ua.match(/mxios/)!==null){browser["type"]="maxthon";versionMatch.push(/mxios\/([\d.]+)/)}else if(ua.match(/fxios/)!==null){browser["type"]="firefox";versionMatch.push(/fxios\/([\d.\w]+)/)}else if(ua.match(/edge/)!==null){browser["type"]="edge";versionMatch.push(/edge\/([\d.]+)/)}else if(ua.match(/metasr/)!==null){browser["type"]="sogou";versionMatch.push(/metasr ([\d.]+)/)}else if(ua.match(/micromessenger/)!==null){browser["type"]="micromessenger";versionMatch.push(/micromessenger\/([\d.]+)/)}else if(ua.match(/mqqbrowser/)!==null){browser["type"]="qq";versionMatch.push(/mqqbrowser\/([\d.]+)/)}else if(ua.match(/qqbrowserlite/)!==null){browser["type"]="qq";versionMatch.push(/qqbrowserlite\/([\d.]+)/)}else if(ua.match(/tencenttraveler/)!==null){browser["type"]="qq";versionMatch.push(/tencenttraveler\/([\d.]+)/)}else if(ua.match(/qqbrowser/)!==null){browser["type"]="qq";versionMatch.push(/qqbrowser\/([\d.]+)/)}else if(ua.match(/maxthon/)!==null){browser["type"]="maxthon";versionMatch.push(/maxthon\/([\d.]+)/)}else if(ua.match(/ubrowser/)!==null){browser["type"]="uc";versionMatch.push(/ubrowser\/([\d.]+)/)}else if(ua.match(/ucbrowser/)!==null){browser["type"]="uc";versionMatch.push(/ucbrowser\/([\d.]+)/)}else if(ua.match(/firefox/)!==null){browser["type"]="firefox";versionMatch.push(/firefox\/([\d.]+)/)}else if(ua.match(/opera/)!==null){browser["type"]="opera";versionMatch.push(/opera\/([\d.]+)/)}else if(ua.match(/opr/)!==null){browser["type"]="opera";versionMatch.push(/opr\/([\d.]+)/)}else if(ua.match(/chrome/)!==null){browser["type"]="chrome";versionMatch.push(/chrome\/([\d.]+)/)}else if(ua.match(/safari/)!==null){browser["type"]="safari";versionMatch.push(/version\/([\d.]+)/)}else if(ua.match(/trident/)!==null||ua.match(/msie/)!==null){browser["type"]="ie"}if(browser["type"]==="ie"){var tridentVersion=ua.match(/trident\/([\d.]+)/)?ua.match(/trident\/([\d.]+)/)[1]:"";var msieVersion=ua.match(/msie ([\d.]+)/)?ua.match(/msie ([\d.]+)/)[1]:"";if(tridentVersion!==""){browser["version"]=String(parseInt(tridentVersion)+4)}else if(msieVersion!==""){browser["version"]=msieVersion}}else if(versionMatch){browser["version"]=ua.match(versionMatch[0])?ua.match(versionMatch[0])[1]:""}}catch(e){Log.w("getting browser info failed due to ",e)}return browser},properties:function properties(){var browserInfo=_.info.browser();return _.extend({"#os":_.info.os(),"#lib_version":Config.LIB_VERSION,"#lib":"js","#screen_height":screen.height,"#screen_width":screen.width,"#browser":browserInfo.type,"#browser_version":browserInfo.version,"#system_language":_.check.isString(navigator.languages[1])?navigator.languages[1].toLowerCase():"Value exception","#ua":_.check.isString(navigator.userAgent)?navigator.userAgent.toLowerCase():"Value exception","#utm":_.getUtm()})},pageProperties:function pageProperties(){var referrer=_.getReferrer();return _.stripEmptyProperties({"#referrer":referrer,"#referrer_host":referrer?_.url("hostname",referrer):referrer,"#url":location.href,"#url_path":location.pathname,"#title":document.title})}};_.getUtm=function(){var params={};_.each(utmTypes,function(kwkey){var kw=_.getQueryParam(location.href,kwkey);if(kw.length){params[kwkey]=kw}});return JSON.stringify(params)};_.getQueryParam=function(url,key){key=key.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");url=_.decodeURIComponent(url);var regexS="[\\?&]"+key+"=([^&#]*)",regex=new RegExp(regexS),results=regex.exec(url);if(results===null||results&&typeof results[1]!=="string"&&results[1].length){return""}else{return _.decodeURIComponent(results[1])}};_.createString=function(length){var expect=length;var str=Math.random().toString(36).substr(2);while(str.length<expect){str+=Math.random().toString(36).substr(2)}str=str.substr(0,length);return str};_.createAesKey=function(){return _.createString(16)};_.generateEncryptyData=function(text,secretKey){if(typeof secretKey==="undefined"){return text}var pkey=secretKey["publicKey"];var v=secretKey["version"];if(typeof pkey==="undefined"||typeof v==="undefined"){return text}if(typeof CryptoJS==="undefined"||typeof JSEncrypt==="undefined"){return text}var strKey=_.createAesKey();try{var key=CryptoJS.enc.Utf8.parse(strKey);var data=CryptoJS.enc.Utf8.parse(JSON.stringify(text));var aesStr=CryptoJS.AES.encrypt(data,key,{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7}).toString();var encrypt=new JSEncrypt;encrypt.setPublicKey(pkey);var rsaStr=encrypt.encrypt(strKey);if(rsaStr===false){Log.w("encryption failed");return text}return{pkv:v,ekey:rsaStr,payload:aesStr}}catch(e){Log.w("encryption failed")}return text};_.paramType=function(param){return Object.prototype.toString.call(param).replace("[object ","").replace("]","")};_.addEvent=function(el,type,fn,useCapture){if(document.addEventListener){if((this.paramType(el)==="Array"||this.paramType(el)==="HTMLCollection")&&el.length&&el!==window){for(var i=0;i<el.length;i++){this.addEvent(el[i],type,fn,useCapture)}}else{el.addEventListener(type,fn,useCapture)}}else{if(el.length&&el!==window){for(var index=0;index<el.length;index++){this.addEvent(el[index],type,fn)}}else{el.attachEvent("on"+type,function(){return fn.call(el,window.event)})}}};_.getRandom=function(){var today=new Date;var seed=today.getTime();var num=Math.floor(Math.random()*1e6);return seed+"_"+num};_.safeJSONParse=function(str){var val=null;try{val=JSON.parse(str)}catch(e){return str}return val};_.saveObjectVal=function(name,value){if(!_.check.isString(value)){value=JSON.stringify(value)}_.localStorage.set(name,value)};_.readObjectVal=function(name){var value=_.localStorage.get(name);if(!value)return null;return _.safeJSONParse(value)};_.indexOf=function(arr,target){var indexof=arr.indexOf;if(indexof){return indexof.call(arr,target)}else{for(var i=0;i<arr.length;i++){if(target===arr[i]){return i}}return-1}};_.hasEncrypty=function(obj){if(_.check.isObject()){return obj.pkv!=="undefined"&&obj.ekey!=="undefined"&&obj.payload!=="undefined"}return false};_.addSiteEvent=function(target,eventName,eventHandler,useCapture){function fixEvent(event){if(event){event.preventDefault=fixEvent.preventDefault;event.stopPropagation=fixEvent.stopPropagation;event._getPath=fixEvent._getPath}return event}fixEvent._getPath=function(){var ev=this;return this.path||this.composedPath&&this.composedPath()||ry(ev.target).getParents()};function ry(dom){return new DomElementInfo(dom)}var DomElementInfo=function DomElementInfo(dom){this.ele=dom};fixEvent.preventDefault=function(){this.returnValue=false};fixEvent.stopPropagation=function(){this.cancelBubble=true};var registerEvent=function registerEvent(element,type,handler){if(useCapture===undefined&&type==="click"){useCapture=true}if(element&&element.addEventListener){element.addEventListener(type,function(e){e._getPath=fixEvent._getPath;handler.call(this,e)},useCapture)}else{var ontype="on"+type;var oldHandler=element[ontype];element[ontype]=makeHandler(element,handler,oldHandler,type)}};function makeHandler(element,newHandler,oldHandlers,type){var handler=function handler(event){event=event||fixEvent(window.event);if(!event){return undefined}event.target=event.srcElement;var ret=true;var oldResult,newResult;if(typeof oldHandlers==="function"){oldResult=oldHandlers(event)}newResult=newHandler.call(element,event);if(type!=="beforeunload"){if(false===oldResult||false===newResult){ret=false}return ret}};return handler}registerEvent.apply(null,arguments)};_.getURLSearchParams=function(queryString){queryString=queryString||"";var args={};var query=queryString.substring(1);var pairs=query.split("&");for(var i=0;i<pairs.length;i++){var pos=pairs[i].indexOf("=");if(pos===-1)continue;var name=pairs[i].substring(0,pos);var value=pairs[i].substring(pos+1);name=_.decodeURIComponent(name);value=_.decodeURIComponent(value);args[name]=value}return args};_.urlParse=function(url){var URLParser=function URLParser(url){this._fields={Username:4,Password:5,Port:7,Protocol:2,Host:6,Path:8,URL:0,QueryString:9,Fragment:10};this._values={};this._regex=/^((\w+):\/\/)?((\w+):?(\w+)?@)?([^\/\?:]+):?(\d+)?(\/?[^\?#]+)?\??([^#]+)?#?(\w*)/;if(typeof url!=="undefined"){this._parse(url)}};URLParser.prototype.setUrl=function(url){this._parse(url)};URLParser.prototype._initValues=function(){for(var a in this._fields){this._values[a]=""}};URLParser.prototype.addQueryString=function(queryObj){if(_typeof(queryObj)!=="object"){return false}var query=this._values.QueryString||"";for(var i in queryObj){if(new RegExp(i+"[^&]+").test(query)){query=query.replace(new RegExp(i+"[^&]+"),i+"="+queryObj[i])}else{if(query.slice(-1)==="&"){query=query+i+"="+queryObj[i]}else{if(query===""){query=i+"="+queryObj[i]}else{query=query+"&"+i+"="+queryObj[i]}}}}this._values.QueryString=query};URLParser.prototype.getUrl=function(){var url="";url+=this._values.Origin;url+=this._values.Port?":"+this._values.Port:"";url+=this._values.Path;url+=this._values.QueryString?"?"+this._values.QueryString:"";url+=this._values.Fragment?"#"+this._values.Fragment:"";return url};URLParser.prototype._parse=function(url){this._initValues();var b=this._regex.exec(url);if(!b){Log.i("URLParser::_parse -> Invalid URL")}var urlTmp=url.split("#");var urlPart=urlTmp[0];var hashPart=urlTmp.slice(1).join("#");b=this._regex.exec(urlPart);for(var c in this._fields){if(typeof b[this._fields[c]]!=="undefined"){this._values[c]=b[this._fields[c]]}}this._values["Hostname"]=this._values["Host"].replace(/:\d+$/,"");this._values["Origin"]=this._values["Protocol"]+"://"+this._values["Hostname"];this._values["Fragment"]=hashPart};return new URLParser(url)};_.trim=function(str){return str.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};_.URL=function(url){var result={};var isURLAPIWorking=function isURLAPIWorking(){var url;try{url=new URL("http://modernizr.com/");return url.href==="http://modernizr.com/"}catch(e){return false}};if(typeof window.URL==="function"&&isURLAPIWorking()){result=new URL(url);if(!result.searchParams){result.searchParams=function(){var params=_.getURLSearchParams(result.search);return{get:function get(searchParam){return params[searchParam]}}}()}}else{if(!_.check.isString(url)){url=String(url)}url=_.trim(url);var _regex=/^https?:\/\/.+/;if(_regex.test(url)===false){Log.w("Invalid URL");return}var instance=_.urlParse(url);result.hash=instance._values.Fragment;result.host=instance._values.Host?instance._values.Host+(instance._values.Port?":"+instance._values.Port:""):"";result.href=instance._values.URL;result.password=instance._values.Password;result.pathname=instance._values.Path;result.port=instance._values.Port;result.search=instance._values.QueryString?"?"+instance._values.QueryString:"";result.username=instance._values.Username;result.hostname=instance._values.Hostname;result.protocol=instance._values.Protocol?instance._values.Protocol+":":"";result.origin=instance._values.Origin?instance._values.Origin+(instance._values.Port?":"+instance._values.Port:""):"";result.searchParams=function(){var params=_.getURLSearchParams("?"+instance._values.QueryString);return{get:function get(searchParam){return params[searchParam]}}}()}return result};var Log=function(){function Log(){_classCallCheck(this,Log)}_createClass(Log,null,[{key:"i",value:function i(){if(!this.showLog){return false}if(this.showLog===true||this.showLog==="string"){arguments[0]=_.formatJsonString(arguments[0])}if((typeof console==="undefined"?"undefined":_typeof(console))==="object"&&console.log){try{return console.log.apply(console,arguments)}catch(e){console.log(arguments[0])}}}},{key:"w",value:function w(){if(!this.showLog){return false}if(this.showLog===true||this.showLog==="string"){arguments[0]=_.formatJsonString(arguments[0])}if((typeof console==="undefined"?"undefined":_typeof(console))==="object"&&console.warn){try{return console.warn.apply(console,arguments)}catch(e){console.warn(arguments[0])}}}}]);return Log}();var KEY_NAME_MATCH_REGEX=/^[a-zA-Z][a-zA-Z0-9_]{0,49}$/;var PropertyChecker=function(){function PropertyChecker(){_classCallCheck(this,PropertyChecker)}_createClass(PropertyChecker,null,[{key:"stripProperties",value:function stripProperties(prop){if(!_.check.isObject(prop)){return prop}_.each(prop,function(v,k){if(!(_.check.isString(v)||_.check.isNumber(v)||_.check.isDate(v)||_.check.isBoolean(v)||_.check.isArray(v)||_.check.isObject(v))){Log.w("The format of Data-",k,v," does not meet the requirements and may not be stored correctly. The attribute value only supports String, Number, Date, Boolean, Arrayï¼ŒObject")}});return prop}},{key:"_checkPropertiesKey",value:function _checkPropertiesKey(obj){var flag=true;_.each(obj,function(content,key){if(!KEY_NAME_MATCH_REGEX.test(key)){Log.w("invalid key: "+key);flag=false}});return flag}},{key:"event",value:function event(s){if(!_.check.isString(s)||!KEY_NAME_MATCH_REGEX.test(s)){Log.w("Please check the parameter format, eventName must be an English letter or a string starting with '_', containing letters and numbers with no more than 50 characters: "+s);return false}else{return true}}},{key:"propertyName",value:function propertyName(s){if(!_.check.isString(s)||!KEY_NAME_MATCH_REGEX.test(s)){Log.w("Please check the parameter format, propertyName must be an English letter or a string starting with '_', containing letters and numbers with no more than 50 characters: "+s);return false}else{return true}}},{key:"properties",value:function properties(p){this.stripProperties(p);if(p){if(_.check.isObject(p)){if(this._checkPropertiesKey(p)){return true}else{Log.w("Please check the parameter format, the key of properties can only start with a letter, contain numbers, letters and underscores _, and the maximum length is 50 characters");return false}}else{return false}}else{return true}}},{key:"propertiesMust",value:function propertiesMust(p){this.stripProperties(p);if(p===undefined||!_.check.isObject(p)||_.check.isEmptyObject(p)){Log.w("properties must be objects and have values");return false}else{if(this._checkPropertiesKey(p)){return true}else{Log.w("Please check the parameter format, the key of properties can only start with a letter, contain numbers, letters and underscores _, and the maximum length is 50 characters");return false}}}},{key:"userId",value:function userId(id){if(_.check.isString(id)&&/^.{1,63}$/.test(id)){return true}else{Log.w("User id must be a string that cannot be empty and is less than 64 bits");return false}}}]);return PropertyChecker}();var MASTER_INSTANCE_NAME="thinkingdata";var DEFAULT_CONFIG={_name:MASTER_INSTANCE_NAME,appId:"",send_method:"image",persistence:"localStorage",persistencePrefix:"ThinkingDataJSSDK",persistenceEnabled:true,crossSubDomain:true,maxReferrerStringLength:200,showLog:true,dataSendTimeout:3e3,useAppTrack:false,strict:false,tryCount:3,enableCalibrationTime:false};var ThinkingDataPersistence=function ThinkingDataPersistence(param){this["_state"]={};this.crossSubDomain=param["crossSubDomain"];this.enabled=param["persistenceEnabled"];var oldCookie=null;if(this.enabled){if(param["crossSubDomain"]===false){var sub=_.url("sub",location.href);if(typeof sub==="string"&&sub!==""){this.name=param["persistencePrefix"]+"_"+sub}else{this.name=param["persistencePrefix"]+"_root"}}else{this.name=param["persistencePrefix"]+"_cross"}var storageType=param["persistence"];if(storageType!=="cookie"&&storageType!=="localStorage"){Log.i("Unknown persistence type "+storageType+"; falling back to cookie");storageType=param["persistence"]="cookie"}if(storageType==="localStorage"&&_.localStorage.isSupported()){this.storage=_.localStorage;oldCookie=_.cookie.get(this.name);if(oldCookie){_.cookie.remove(this.name,this.crossSubDomain)}}else{Log.i("localStorage is not support by the browser; falling back to cookie");this.storage=_.cookie}}this._load(oldCookie);if(!this.getDistinctId()){var uuid=param.uuid?param.uuid:_.UUID();this._setDeviceId(uuid);this.setDistinctId(uuid)}};ThinkingDataPersistence.prototype._load=function(oldCookie){if(!this.enabled)return;var entry;if(oldCookie!==null){entry=oldCookie}else{entry=this.storage.get(this.name)}if(entry!==null&&_.check.isJSONString(entry)){this._state=_.extend({},JSON.parse(entry))}if(oldCookie!==null){this._save()}};ThinkingDataPersistence.prototype.getDistinctId=function(){return this._state.distinct_id};ThinkingDataPersistence.prototype.setDistinctId=function(distinctId){this._set("distinct_id",distinctId)};ThinkingDataPersistence.prototype.setEnableTracking=function(enabled){this._set("enable_tracking",enabled)};ThinkingDataPersistence.prototype.getEnableTracking=function(){return _.check.isUndefined(this._state.enable_tracking)?true:this._state.enable_tracking};ThinkingDataPersistence.prototype.clear=function(){this._state={};this._save()};ThinkingDataPersistence.prototype.setOptTracking=function(optTracking){this._set("opt_tracking",optTracking)};ThinkingDataPersistence.prototype.getOptTracking=function(){return _.check.isUndefined(this._state.opt_tracking)?true:this._state.opt_tracking};ThinkingDataPersistence.prototype.setDistinctId=function(distinctId){this._set("distinct_id",distinctId)};ThinkingDataPersistence.prototype.getAccountId=function(){return this._state.account_id};ThinkingDataPersistence.prototype.setAccountId=function(accountId){this._set("account_id",accountId)};ThinkingDataPersistence.prototype.getDeviceId=function(){return this._state.device_id};ThinkingDataPersistence.prototype.setSuperProperties=function(superProperties){this._set("super_properties",superProperties)};ThinkingDataPersistence.prototype.getSuperProperties=function(){return this._state.super_properties||{}};ThinkingDataPersistence.prototype.setEventTimer=function(eventName,timestamp){var timers=this._state.event_timers||{};timers[eventName]=timestamp;this._set("event_timers",timers)};ThinkingDataPersistence.prototype.clearEventTimer=function(){this._set("event_timers",{})};ThinkingDataPersistence.prototype.removeEventTimer=function(eventName){var timers=this._state.event_timers||{};var timestamp=timers[eventName];if(!_.check.isUndefined(timestamp)){delete this._state.event_timers[eventName];this._save()}return timestamp};ThinkingDataPersistence.prototype._setDeviceId=function(uuid){if(this._state.device_id){Log.w("Current device_id is ",this.getDeviceId(),", it couldn't been set to: ",uuid);return}this._set("device_id",uuid)};ThinkingDataPersistence.prototype._save=function(){if(this.enabled){this.storage.set(this.name,JSON.stringify(this._state),73e3,this.crossSubDomain)}};ThinkingDataPersistence.prototype._set=function(name,value){this._state=this._state||{};this._state[name]=value;this._save()};var ThinkingDataAnalyticsLib=function ThinkingDataAnalyticsLib(){};ThinkingDataAnalyticsLib.prototype.trackLink=function(dom,eventName,eventProperties){var _this=this;if(!this._isCollectData()){return}var strict=this._getConfig("strict");if(!PropertyChecker.properties(eventProperties)&&strict){Log.w("trackLink failed due to invalid properties.");return}if(dom&&_.check.isObject(dom)){var elements=[];_.each(dom,function(value,key){if(value&&_.check.isArray(value)){_.each(value,function(typeName){switch(key){case"tag":_.each(document.getElementsByTagName(typeName),function(element){if(elements.indexOf(element)<0){elements.push(element)}});break;case"class":_.each(document.getElementsByClassName(typeName),function(element){if(elements.indexOf(element)<0){elements.push(element)}});break;case"id":var element=document.getElementById(typeName);if(element!==null&&elements.indexOf(element)<0){elements.push(element)}break}})}});_.each(elements,function(element){if(element!==null){var properties=_.extend({},_.info.pageProperties(),eventProperties);properties["#element_type"]=element.nodeName.toLowerCase();if(_.check.isUndefined(properties["name"])){properties["name"]=element.getAttribute("td-name")||element.innerHTML||element.value||"Unable to get Identify"}element.addEventListener("click",function(){_this._sendRequest({type:"track",event:eventName,properties:strict?PropertyChecker.stripProperties(properties):properties})})}})}};ThinkingDataAnalyticsLib.prototype.setPageProperty=function(obj){if(!this._isCollectData()){return}if(PropertyChecker.properties(obj)||!this._getConfig("strict")){_.extend(this.currentProps,obj)}else{Log.w("Page property setting error")}};ThinkingDataAnalyticsLib.prototype.getPageProperty=function(){return this.currentProps};ThinkingDataAnalyticsLib.prototype.getPresetProperties=function(){var properties=_.info.properties();var presetProperties={};presetProperties.os=properties["#os"];presetProperties.screenWidth=properties["#screen_width"];presetProperties.screenHeight=properties["#screen_height"];presetProperties.browser=properties["#browser"];presetProperties.browserVersion=properties["#browser_version"];presetProperties.deviceId=this.getDeviceId();var zoneOffset=0-(new Date).getTimezoneOffset()/60;if(this._getConfig("zoneOffset")){zoneOffset=this._getConfig("zoneOffset")}presetProperties.zoneOffset=zoneOffset;presetProperties.toEventPresetProperties=function(){return{"#os":presetProperties.os,"#screen_width":presetProperties.screenWidth,"#screen_height":presetProperties.screenHeight,"#browser":presetProperties.browser,"#browser_version":presetProperties.browserVersion,"#device_id":presetProperties.deviceId,"#zone_offset":presetProperties.zoneOffset}};return presetProperties};ThinkingDataAnalyticsLib.prototype.login=function(accountId){if(!this._isCollectData()){return}if(typeof accountId==="number"){accountId=String(accountId)}if(PropertyChecker.userId(accountId)||!this._getConfig("strict")){var currentAccountId=this["persistence"].getAccountId();if(accountId!==currentAccountId){this["persistence"].setAccountId(accountId)}}else{Log.e("The parameters of the login API must be strings")}};ThinkingDataAnalyticsLib.prototype.logout=function(isChangeId){if(!this._isCollectData()){return}if(isChangeId===true){var distinctId=_.UUID();this["persistence"].setDistinctId(distinctId)}this["persistence"].setAccountId("")};ThinkingDataAnalyticsLib.prototype.userSet=function(userProperties,callback){if(!this._isCollectData()){return}if(PropertyChecker.propertiesMust(userProperties)||!this._getConfig("strict")){this._sendRequest({type:"user_set",properties:userProperties},callback)}};ThinkingDataAnalyticsLib.prototype.userSetOnce=function(userProperties,callback){if(!this._isCollectData()){return}if(PropertyChecker.propertiesMust(userProperties)||!this._getConfig("strict")){this._sendRequest({type:"user_setOnce",properties:userProperties},callback)}};ThinkingDataAnalyticsLib.prototype.userUnset=function(property,callback){if(!this._isCollectData()){return}if(PropertyChecker.propertyName(property)||!this._getConfig("strict")){var properties={};properties[property]=0;this._sendRequest({type:"user_unset",properties:properties},callback)}};ThinkingDataAnalyticsLib.prototype.userAdd=function(userProperties,callback){if(!this._isCollectData()){return}if(_.check.isString(userProperties)){var str=userProperties;userProperties={};userProperties[str]=1}function isChecked(p){for(var i in p){if(!/-*\d+/.test(String(p[i]))){return false}}return true}if(PropertyChecker.propertiesMust(userProperties)){if(isChecked(userProperties)||!this._getConfig("strict")){this._sendRequest({type:"user_add",properties:userProperties},callback)}else{Log.w("The property value of useradd api must be a number")}}};ThinkingDataAnalyticsLib.prototype.userAppend=function(userProperties,callback){if(!this._isCollectData()){return}function isChecked(p){for(var i in p){if(!_.check.isArray(p[i])){return false}}return true}if(PropertyChecker.propertiesMust(userProperties)&&isChecked(userProperties)||!this._getConfig("strict")){this._sendRequest({type:"user_append",properties:userProperties},callback)}else{Log.w("The value in the userAppend property can only be Array")}};ThinkingDataAnalyticsLib.prototype.userUniqAppend=function(userProperties,callback){if(!this._isCollectData()){return}function isChecked(p){for(var i in p){if(!_.check.isArray(p[i])){return false}}return true}if(PropertyChecker.propertiesMust(userProperties)&&isChecked(userProperties)||!this._getConfig("strict")){this._sendRequest({type:"user_uniq_append",properties:userProperties},callback)}else{Log.w("The value in the userUniqAppend property can only be Array")}};ThinkingDataAnalyticsLib.prototype.flush=function(){if(this.batchConsumer&&!this._isDebug()){this.batchConsumer.flush()}};ThinkingDataAnalyticsLib.prototype.userDel=function(callback){if(!this._isCollectData()){return}this._sendRequest({type:"user_del"},callback)};ThinkingDataAnalyticsLib.prototype._sendRequest=function(eventData,callback,tryBeacon){var time=_.check.isUndefined(eventData.time)||!_.check.isDate(eventData.time)?new Date:eventData.time;var data={data:[{"#type":eventData.type,"#time":_.formatDate(_.formatTimeZone(time,this._getConfig("zoneOffset"))),"#distinct_id":this["persistence"].getDistinctId()}]};if(this["persistence"].getAccountId()){data.data[0]["#account_id"]=this["persistence"].getAccountId()}if(eventData.type==="track"||eventData.type==="track_update"||eventData.type==="track_overwrite"){data.data[0]["#event_name"]=eventData.event;if(eventData.type==="track_update"||eventData.type==="track_overwrite"){data.data[0]["#event_id"]=eventData.extraId}else if(eventData.firstCheckId){data.data[0]["#first_check_id"]=eventData.firstCheckId}var zoneOffset=0-time.getTimezoneOffset()/60;if(this._getConfig("zoneOffset")){zoneOffset=this._getConfig("zoneOffset")}data.data[0]["properties"]=_.extend({},{"#device_id":this["persistence"].getDeviceId(),"#zone_offset":zoneOffset},_.info.properties(),this.getSuperProperties(),this.dynamicProperties?this.dynamicProperties():{},this.getPageProperty());var startTimestamp=this["persistence"].removeEventTimer(eventData.event);if(!_.check.isUndefined(startTimestamp)){var durationMillisecond=(new Date).getTime()-startTimestamp;var d=parseFloat((durationMillisecond/1e3).toFixed(3));if(d>24*60*60){d=24*60*60}data.data[0]["properties"]["#duration"]=d}}else{data.data[0]["properties"]={}}if(_.check.isObject(eventData.properties)&&!_.check.isEmptyObject(eventData.properties)){_.extend(data.data[0].properties,eventData.properties)}_.searchObjDate(data.data[0],this._getConfig("zoneOffset"));if(this._getConfig("send_method")==="ajax"){data.data[0]=_.generateEncryptyData(data.data[0],this._getConfig("secretKey"))}data["#app_id"]=this._getConfig("appId");data["#flush_time"]=_.formatTimeZone(new Date,this._getConfig("zoneOffset")).getTime();Log.i(data);if(this._getConfig("useAppTrack")){var jsBridge=window.ThinkingData_APP_JS_Bridge||{};if(_typeof(jsBridge)==="object"&&jsBridge.thinkingdata_track){jsBridge.thinkingdata_track(JSON.stringify(data));typeof callback==="function"&&callback();return}else if(/td-sdk-ios/.test(navigator.userAgent)&&!window.MSStream){var iframe=document.createElement("iframe");iframe.setAttribute("src","thinkinganalytics://trackEvent?event="+_.encodeURIComponent(JSON.stringify(data)));document.documentElement.appendChild(iframe);iframe.parentNode.removeChild(iframe);iframe=null;typeof callback==="function"&&callback();return}}if(tryBeacon){data.data[0]["#uuid"]=_.UUIDv4()}if(this.batchConsumer&&!this._isDebug()&&!tryBeacon){this.batchConsumer.add(data.data[0]);return}var urlData;if(this._isDebug()){urlData="&data="+_.encodeURIComponent(JSON.stringify(data.data[0]))+"&source=client&deviceId="+this.getDeviceId()+"&appid="+this._getConfig("appId")+"&version="+Config.LIB_VERSION;if(this._getConfig("mode")==="debug_only"){urlData=urlData+"&dryRun=1"}}else{data=JSON.stringify(data);var base64Data=_.base64Encode(data);var crc="crc="+_.hashCode(base64Data);urlData="&data="+_.encodeURIComponent(base64Data)+"&ext="+_.encodeURIComponent(crc)+"&version="+Config.LIB_VERSION}if(tryBeacon&&(typeof navigator==="undefined"?"undefined":_typeof(navigator))!==undefined&&navigator.sendBeacon){var formData=new FormData;if(this._isDebug()){formData.append("data",JSON.stringify(data.data[0]));formData.append("source","client");formData.append("deviceId",this.getDeviceId());formData.append("appid",this._getConfig("appId"));formData.append("version",Config.LIB_VERSION);if(this._getConfig("mode")==="debug_only"){formData.append("dryRun",1)}}else{formData.append("data",_.base64Encode(data))}navigator.sendBeacon(this._getConfig("serverUrl"),formData);return}if(this._getConfig("send_method")==="ajax"){new AjaxTask(urlData,this._getConfig("serverUrl"),this._getConfig("tryCount"),callback,this._isDebug()).run()}else{this._sendRequestWithImage(urlData,callback)}};var dataStoragePrefix="ta_";var tabStoragePrefix="tab_";function BatchConsumer(config){this.config=config;this.timer=null;this.batchConfig=_.extend({size:5,interval:5e3,storageLimit:200},this.config["batch"]);if(this.batchConfig.size<1){this.batchConfig.size=1}if(this.batchConfig.size>30){this.batchConfig.size=30}this.prefix=this.config["persistencePrefix"];this.tabKey=this.prefix+tabStoragePrefix+this.config["appId"];this.storageLimit=this.batchConfig["storageLimit"]}BatchConsumer.prototype={batchInterval:function batchInterval(){var self=this;self.timer=setTimeout(function(){self.recycle();self.send();clearTimeout(self.timer);self.batchInterval()},this.batchConfig.interval)},add:function add(data){var d=data;var dataKey=this.prefix+dataStoragePrefix+this.config["appId"]+"_"+String(_.getRandom());var tabStorage=_.localStorage.get(this.tabKey);if(tabStorage===null){tabStorage=[]}else{tabStorage=_.safeJSONParse(tabStorage)||[]}if(tabStorage.length<=this.storageLimit){tabStorage.push(dataKey);_.localStorage.set(this.tabKey,JSON.stringify(tabStorage));_.saveObjectVal(dataKey,d)}else{var deleteDatas=tabStorage.splice(0,20);tabStorage.push(dataKey);_.localStorage.set(this.tabKey,JSON.stringify(tabStorage));_.saveObjectVal(dataKey,d);var postData={};var dList=[];for(var i=0;i<deleteDatas.length;i++){var item=_.readObjectVal(deleteDatas[i]);if(!_.hasEncrypty(item)){item=_.generateEncryptyData(item,this.config["secretKey"])}dList.push(item)}postData["data"]=dList;postData["#app_id"]=this.config["appId"];postData["#flush_time"]=_.formatTimeZone(new Date,this.config["zoneOffset"]).getTime();this.request(postData,deleteDatas)}},flush:function flush(){clearTimeout(this.timer);this.send();this.batchInterval()},send:function send(){var tabStorage=_.localStorage.get(this.tabKey);if(tabStorage){tabStorage=_.safeJSONParse(tabStorage)||[];if(tabStorage.length){var postData={};var data=[];var tabList=[];var len=tabStorage.length<this.batchConfig.size?tabStorage.length:this.batchConfig.size;for(var i=0;i<len;i++){var d=_.readObjectVal(tabStorage[i]);if(!_.hasEncrypty(d)){d=_.generateEncryptyData(d,this.config["secretKey"])}data.push(d);tabList.push(tabStorage[i])}postData["data"]=data;postData["#app_id"]=this.config["appId"];postData["#flush_time"]=_.formatTimeZone(new Date,this.config["zoneOffset"]).getTime();this.request(postData,tabList)}}},request:function request(data,dataKeys){var self=this;Log.i("flush data");Log.i(data);var pData=JSON.stringify(data);var base64Data=_.base64Encode(pData);var crc="crc="+_.hashCode(base64Data);var urlData="&data="+_.encodeURIComponent(base64Data)+"&ext="+_.encodeURIComponent(crc)+"&version="+Config.LIB_VERSION;new AjaxTask(urlData,this.config["serverUrl"],this.config["tryCount"],function(){self.remove(dataKeys)},false).run()},remove:function remove(dataKeys){var tabStorage=_.localStorage.get(this.tabKey);if(tabStorage){var tabStorageData=_.safeJSONParse(tabStorage)||[];for(var i=0;i<dataKeys.length;i++){var idx=_.indexOf(tabStorageData,dataKeys[i]);if(idx>-1){tabStorageData.splice(idx,1)}_.localStorage.remove(dataKeys[i])}_.localStorage.set(this.tabKey,JSON.stringify(tabStorageData))}},recycle:function recycle(){var tabStorage=_.localStorage.get(this.tabKey);if(tabStorage){tabStorage=_.safeJSONParse(tabStorage)||[];if(tabStorage.length===0){for(var i=0;i<localStorage.length;i++){var key=localStorage.key(i);if(key.indexOf(this.prefix+dataStoragePrefix+this.config["appId"])===0){tabStorage.push(key)}}if(tabStorage.length>0){_.localStorage.set(this.tabKey,JSON.stringify(tabStorage))}}}}};var AjaxTask=function(){function AjaxTask(data,serverUrl,tryCount,callback,isDebug){_classCallCheck(this,AjaxTask);this.data=data;this.serverUrl=serverUrl;this.tryCount=tryCount?tryCount:3;this.callback=callback;this.isDebug=isDebug}_createClass(AjaxTask,[{key:"run",value:function run(){var xhr=null;if(window.XMLHttpRequest){xhr=new XMLHttpRequest}else{xhr=new ActiveXObject("Microsoft.XMLHTTP")}xhr.open("post",this.serverUrl,true);xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");var task=this;xhr.onreadystatechange=function(){if(xhr.readyState===4){if(xhr.status>=200&&xhr.status<300||xhr.status===304){task.callback&&task.callback();if(task.isDebug){var response=JSON.parse(xhr.response);if(response["errorLevel"]!==0){Log.w(response)}else{Log.i(response)}}}else{task.onFailed()}}};xhr.send(this.data)}},{key:"onFailed",value:function onFailed(){if(--this.tryCount>0){this.run()}}}]);return AjaxTask}();ThinkingDataAnalyticsLib.prototype._isDebug=function(){return this._getConfig("mode")==="debug"||this._getConfig("mode")==="debug_only"};ThinkingDataAnalyticsLib.prototype._sendRequestWithImage=function(data,callback){function callAndDelete(img){if(img&&!img.hasCalled){img.hasCalled=true;img.callback&&img.callback()}}var url=this._getConfig("serverUrl").indexOf("?")!==-1?this._getConfig("serverUrl"):this._getConfig("serverUrl")+"?";var src=url+data;var img=document.createElement("img");img.callback=callback;setTimeout(callAndDelete,this._getConfig("dataSendTimeout"),img);img.onload=function(){this.onload=null;callAndDelete(this)};img.onerror=function(){this.onerror=null;callAndDelete(this)};img.onabort=function(){this.onabort=null;callAndDelete(this)};img.src=src};ThinkingDataAnalyticsLib.prototype.track=function(eventName,eventProperties,eventTime,callback){if(!this._isCollectData()){return}if(eventName==="ta_page_show"||eventName==="ta_page_hide"){this._sendRequest({type:"track",event:eventName,time:eventTime,properties:eventProperties},callback);return}if(PropertyChecker.event(eventName)&&PropertyChecker.properties(eventProperties)||!this._getConfig("strict")){this._sendRequest({type:"track",event:eventName,time:eventTime,properties:eventProperties},callback)}};ThinkingDataAnalyticsLib.prototype.trackUpdate=function(taEvent){if(!this._isCollectData()){return}if(!_.check.isObject(taEvent)){Log.e("The parameter of updateble event does not meet the requirements");return}if(PropertyChecker.event(taEvent.eventName)&&PropertyChecker.properties(taEvent.properties)||!this._getConfig("strict")){this._sendRequest({type:"track_update",event:taEvent.eventName,time:taEvent.eventTime,properties:taEvent.properties,extraId:taEvent.eventId},taEvent.callback)}};ThinkingDataAnalyticsLib.prototype.trackOverwrite=function(taEvent){if(!this._isCollectData()){return}if(!_.check.isObject(taEvent)){Log.e("The parameter of overwritable event  does not meet the requirements");return}if(PropertyChecker.event(taEvent.eventName)&&PropertyChecker.properties(taEvent.properties)||!this._getConfig("strict")){this._sendRequest({type:"track_overwrite",event:taEvent.eventName,time:taEvent.eventTime,properties:taEvent.properties,extraId:taEvent.eventId},taEvent.callback)}};ThinkingDataAnalyticsLib.prototype.trackFirstEvent=function(taEvent){if(!this._isCollectData()){return}if(!_.check.isObject(taEvent)){Log.e("The parameter of first event does not meet the requirements");return}if(PropertyChecker.event(taEvent.eventName)&&PropertyChecker.properties(taEvent.properties)||!this._getConfig("strict")){this._sendRequest({type:"track",event:taEvent.eventName,time:taEvent.eventTime,properties:taEvent.properties,firstCheckId:taEvent.firstCheckId?taEvent.firstCheckId:this.getDeviceId()},taEvent.callback)}};ThinkingDataAnalyticsLib.prototype.trackWithBeacon=function(eventName,eventProperties,eventTime,callback){if(eventName==="ta_page_hide"){this._sendRequest({type:"track",event:eventName,time:eventTime,properties:eventProperties},callback,true);return}if(PropertyChecker.event(eventName)&&PropertyChecker.properties(eventProperties)||!this._getConfig("strict")){this._sendRequest({type:"track",event:eventName,time:eventTime,properties:eventProperties},callback,true)}};ThinkingDataAnalyticsLib.prototype.identify=function(id){if(!this._isCollectData()){return}if(typeof id==="number"){id=String(id)}if(PropertyChecker.userId(id)||!this._getConfig("strict")){var distinctId=this["persistence"].getDistinctId();if(id!==distinctId){this["persistence"].setDistinctId(id)}}else{Log.e("The parameter of identify API requires a string")}};ThinkingDataAnalyticsLib.prototype.getDistinctId=function(){return this["persistence"].getDistinctId()};ThinkingDataAnalyticsLib.prototype.getDeviceId=function(){return this["persistence"].getDeviceId()};ThinkingDataAnalyticsLib.prototype._isCollectData=function(){return this["persistence"].getOptTracking()&&this["persistence"].getEnableTracking()};ThinkingDataAnalyticsLib.prototype.setSuperProperties=function(superProperties){if(!this._isCollectData()){return}if(PropertyChecker.propertiesMust(superProperties)||!this._getConfig("strict")){this["persistence"].setSuperProperties(_.extend({},this.getSuperProperties(),superProperties))}else{Log.w("The paramater of setSuperProperties API requires object")}};ThinkingDataAnalyticsLib.prototype.getSuperProperties=function(){return this["persistence"].getSuperProperties()};ThinkingDataAnalyticsLib.prototype.clearSuperProperties=function(){if(!this._isCollectData()){return}this["persistence"].setSuperProperties({})};ThinkingDataAnalyticsLib.prototype.unsetSuperProperty=function(propertyName){if(!this._isCollectData()){return}if(_.check.isString(propertyName)){var superProperties=this.getSuperProperties();delete superProperties[propertyName];this["persistence"].setSuperProperties(superProperties)}};ThinkingDataAnalyticsLib.prototype.setDynamicSuperProperties=function(dynamicProperties){if(!this._isCollectData()){return}if(typeof dynamicProperties==="function"){if(PropertyChecker.properties(dynamicProperties())||!this._getConfig("strict")){this.dynamicProperties=dynamicProperties}else{Log.w("The return value of dynamic properties requires an object")}}else{Log.w("The paramater of setDynamicSuperProperties API requires function type")}};ThinkingDataAnalyticsLib.prototype.timeEvent=function(eventName){if(!this._isCollectData()){return}if(_.check.isUndefined(eventName)){Log.w("No event name provided to timeEvent");return}this["persistence"].setEventTimer(eventName,(new Date).getTime())};ThinkingDataAnalyticsLib.prototype.quick=function(type,properties){if(!this._isCollectData()){return}if(typeof type==="string"&&type==="autoTrack"){var quickProperties={};if(PropertyChecker.properties(properties)){_.extend(quickProperties,properties)}this._sendRequest({type:"track",event:"ta_pageview",properties:_.extend(quickProperties,_.info.pageProperties())})}else if(typeof type==="string"&&type==="siteLinker"){siteLinker.init(this,properties)}else{Log.w("The quick method does not support the parameter of"+type)}};ThinkingDataAnalyticsLib.prototype._setConfig=function(config){if(_.check.isObject(config)){_.extend(this["config"],config);if(!this._getConfig("persistencePrefix")){this["config"]["persistencePrefix"]=this["config"]["cookiePrefix"]}if(this["persistence"]);}};ThinkingDataAnalyticsLib.prototype._getConfig=function(propName){return this["config"][propName]};ThinkingDataAnalyticsLib.prototype.init=function(param){if(_.check.isUndefined(this["config"])){this["config"]={};this.currentProps=this.currentProps||{};this._setConfig(_.extend({},DEFAULT_CONFIG,param));this["persistence"]=new ThinkingDataPersistence(this["config"]);var appId=this._getConfig("appId");if(!_.check.isUndefined(appId)){this._setConfig({appId:appId.replace(/\s*/g,"")})}Log.showLog=this._getConfig("showLog");var sendMethod=this._getConfig("send_method");if(sendMethod!=="image"&&sendMethod!=="ajax"&&sendMethod!=="beacon"){Log.i("send_method",sendMethod,"is not supported. Changed to image as default value");this._setConfig({send_method:"image"})}if(this._isDebug()){this._setConfig({serverUrl:_.url("basic",param.serverUrl)+"/data_debug"})}else{this._setConfig({serverUrl:_.url("basic",param.serverUrl)+"/sync_js"})}if(this._getConfig("batch")!==undefined&&this._getConfig("batch")!==false&&_.localStorage.isSupported()){this.batchConsumer=new BatchConsumer(this["config"]);this.batchConsumer.batchInterval()}new PageLifeCycle(this,this._getConfig("autoTrack")).start();var m="normal";if(this.config.mode){m=this.config.mode}Log.i("Thinking Analytics SDK initialized successfully with mode: "+m+", APP ID : "+this.config.appId+", server url: "+this.config.serverUrl+", libversion: "+Config.LIB_VERSION)}else{Log.i("The ThinkingData libraray has been initialized.")}};var PageLifeCycle=function(){function PageLifeCycle(taLib,config){_classCallCheck(this,PageLifeCycle);this.taLib=taLib;if(_.paramType(config)==="Object"&&_.paramType(config.pageShow)==="Boolean"){this.autoPageShow=config.pageShow}else{this.autoPageShow=false}if(_.paramType(config)==="Object"&&_.paramType(config.pageHide)==="Boolean"){this.autoPageHide=config.pageHide}else{this.autoPageHide=false}}_createClass(PageLifeCycle,[{key:"start",value:function start(){var page=this;page.trackPageShowEvent();if("onvisibilitychange"in document){_.addEvent(document,"visibilitychange",function(){if(document.hidden){page.trackPageHideEvent()}else{page.trackPageShowEvent()}})}}},{key:"trackPageShowEvent",value:function trackPageShowEvent(){if(this.autoPageShow){this.taLib.track("ta_page_show",_.info.pageProperties())}this.taLib.timeEvent("ta_page_hide")}},{key:"trackPageHideEvent",value:function trackPageHideEvent(){if(this.autoPageHide){this.taLib.trackWithBeacon("ta_page_hide",_.info.pageProperties())}}},{key:"trackPageHideEventOnClose",value:function trackPageHideEventOnClose(){if(this.autoPageHide&&this.isPageShow){this.taLib.trackWithBeacon("ta_page_hide",_.info.pageProperties())}}}]);return PageLifeCycle}();ThinkingDataAnalyticsLib.prototype.initInstance=function(name,param){if(!_.check.isString(name)||!_.check.isUndefined(param)&&!_.check.isObject(param)){Log.w("invalid parameter of initInstance(string, object).");return null}if(this._getConfig("_name")!==MASTER_INSTANCE_NAME){Log.w("This function is allowed for master instance only");return null}if(name===MASTER_INSTANCE_NAME||this[name]){Log.w("The name ",name," couldn't be used for create new instance.");return null}if(_.check.isUndefined(param)){param={}}var instance=new ThinkingDataAnalyticsLib;var config=_.extend({},this.config,{_name:name,persistenceEnabled:false,uuid:this.getDeviceId()},param);if(config.persistenceEnabled){config.persistencePrefix=config.persistencePrefix+"_"+name}instance.init(config);this[name]=instance};ThinkingDataAnalyticsLib.prototype.enableTracking=function(enabled){if(typeof enabled==="boolean"){this["persistence"].setEnableTracking(enabled)}};ThinkingDataAnalyticsLib.prototype.optOutTracking=function(){this["persistence"].setSuperProperties({});this["persistence"].setAccountId("");this["persistence"].clearEventTimer();this["persistence"].setOptTracking(false)};ThinkingDataAnalyticsLib.prototype.optInTracking=function(){this["persistence"].setOptTracking(true)};ThinkingDataAnalyticsLib.prototype.setTrackStatus=function(config){if(_.check.isObject(config)){var status=config["status"];Log.i("swtich track status : "+status);if(status==="pause"){this.enableTracking(false)}else if(status==="stop"){this.optOutTracking()}else if(status==="normal"){this.enableTracking(true);this.optInTracking()}}};var siteLinker={};siteLinker.getPartUrl=function(part){var t=false;var l=this.option.length;if(l){for(var i=0;i<l;i++){if(part.indexOf(this.option[i]["part_url"])>-1){return true}}}return t};siteLinker.getPartHash=function(part){var len=this.option.length;var temp=false;if(len){for(var i=0;i<len;i++){if(part.indexOf(this.option[i]["part_url"])>-1){return this.option[i]["after_hash"]}}}return!!temp};siteLinker.getCurrenId=function(){var distinctId=this.ta.getDistinctId();var urlId="d"+distinctId;return encodeURIComponent(urlId)};siteLinker.rewriteUrl=function(url,target){var reg=/([^?#]+)(\?[^#]*)?(#.*)?/;var arr=reg.exec(url),nurl="";if(!arr){return}var host=arr[1]||"",search=arr[2]||"",hash=arr[3]||"";var idIndex;if(this.getPartHash(url)){idIndex=hash.indexOf("_tasdk");var queryIndex=hash.indexOf("?");if(queryIndex>-1){if(idIndex>-1){nurl=host+search+"#"+hash.substring(1,idIndex)+"_tasdk="+this.getCurrenId()}else{nurl=host+search+"#"+hash.substring(1)+"&_tasdk="+this.getCurrenId()}}else{nurl=host+search+"#"+hash.substring(1)+"?_tasdk="+this.getCurrenId()}}else{idIndex=search.indexOf("_tasdk");var hasQuery=/^\?(\w)+/.test(search);if(hasQuery){if(idIndex>-1){nurl=host+"?"+search.substring(1,idIndex)+"_tasdk="+this.getCurrenId()+hash}else{nurl=host+"?"+search.substring(1)+"&_tasdk="+this.getCurrenId()+hash}}else{nurl=host+"?"+search.substring(1)+"_tasdk="+this.getCurrenId()+hash}}if(target){target.href=nurl}return nurl};siteLinker.addClickListen=function(){var site=this;var clickFn=function clickFn(event){var target=event.target;var nodeName=target.tagName.toLowerCase();var parentTarget=target.parentNode;var sdkUrl;var sdkTarget;if(nodeName==="a"&&target.href||parentTarget&&parentTarget.tagName&&parentTarget.tagName.toLowerCase()==="a"&&parentTarget.href){if(nodeName==="a"&&target.href){sdkUrl=target.href;sdkTarget=target}else{sdkUrl=parentTarget.href;sdkTarget=parentTarget}var location=_.URL(sdkUrl);var protocol=location.protocol;if(protocol==="http:"||protocol==="https:"){if(site.getPartUrl(sdkUrl)){site.rewriteUrl(sdkUrl,sdkTarget)}}}};_.addSiteEvent(document,"mousedown",clickFn);if(!!window.PointerEvent&&"maxTouchPoints"in window.navigator&&window.navigator.maxTouchPoints>=0){_.addSiteEvent(document,"pointerdown",clickFn)}};siteLinker.getUrlId=function(){var taId=location.href.match(/_tasdk=([aufd][^\?\#\&\=]+)/);if(_.check.isArray(taId)&&taId[1]){var uid=decodeURIComponent(taId[1]);return uid}else{return""}};siteLinker.setRefferId=function(){var distinctId=this.ta.getDistinctId();var urlId=this.getUrlId();if(urlId===""){return false}var isAnonymousId=urlId.substring(0,1)==="d";urlId=urlId.substring(1);if(urlId===distinctId){return false}if(urlId&&isAnonymousId){this.ta.identify(urlId)}};siteLinker.init=function(ta,option){if(this.isInited){return}this.isInited=true;this.ta=ta;this.setRefferId();if(_.check.isObject(option)&&_.check.isArray(option.linker)&&option.linker.length>0){this.addClickListen()}else{return}this.option=option.linker;this.option=resolveOption(this.option);function resolveOption(option){var len=option.length,arr=[];for(var i=0;i<len;i++){if(/[A-Za-z0-9]+\./.test(option[i].part_url)&&Object.prototype.toString.call(option[i].after_hash)==="[object Boolean]"){arr.push(option[i])}else{Log.w("The configuration of linker "+(i+1)+" is not supported.Please check format")}}return arr}};var tdMaster;function initFromSnippet(){if(tdMaster&&tdMaster.isLoadSDK){return}var libName=window["ThinkingDataAnalyticalTool"];if(libName&&typeof(tdMaster=window[libName])==="function"){var snippetVersion=tdMaster["__SV"]||0;if(snippetVersion<1.1){console.error("Version mismatch; please ensure you're using the latest version of the thinkingdata snippet.");return}tdMaster.isLoadSDK=true;var instance=new ThinkingDataAnalyticsLib;instance.init(tdMaster.param);if(tdMaster._q1&&_.check.isArray(tdMaster._q1)&&tdMaster._q1.length>0){_.each(tdMaster._q1,function(content){instance[content[0]].apply(instance,slice.call(content[1]))})}if(typeof instance._getConfig("loaded")==="function"){instance._getConfig("loaded")(instance)}window[libName]=instance;if(tdMaster._q&&_.check.isArray(tdMaster._q)&&tdMaster._q.length>0){_.each(tdMaster._q,function(content){if(content.length===3){instance[content[2]][content[0]].apply(instance[content[2]],slice.call(content[1]))}else{instance[content[0]].apply(instance,slice.call(content[1]))}})}}}initFromSnippet()})();